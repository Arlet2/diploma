# Руководство по развертыванию сервиса push-уведомлений
## Общие сведения
Данный сервис написан на языке Go и отвечает за отправку push-уведомлений. Для его использования необходимы следующие зависимости:
- Postgres в качестве СУБД
- NATS Jetstream в качестве брокера сообщений
- Сервис аутентификации реализующий gRPC сервис

Данный сервис возможно развернуть двумя способами: с помощью Docker образа и подключения к готовой инфраструктуре или с помощью Docker Compose, который позволяет развернуть готовое окружение сразу.

Конфигурация сервиса осуществляется с помощью переменных среды. Ниже приведены все возможные переменные и за что они отвечают.
```.env
SERVER_HOST=0.0.0.0:8080 # хост размещения REST сервера
WS_HOST=0.0.0.0:9000 # хост размещения Websockets сервера

POSTGRES_HOST=db:5432 # хост размещения Postgres
POSTGRES_DATABASE=diploma # название БД в Postgres
POSTGRES_USER=postgres # Имя пользователя в Postgres
POSTGRES_PASSWORD=mysecretpassword # Пароль пользователя в Postgres

NATS_HOST=nats:4222 # хост размещения NATS

GRPC_AUTH_HOST=auth-server:9090 # хост размещения сервиса аутентификации

MESSAGE_TTL=1h # Время жизни push-уведомления в NATS
```
Также стоит отметить, что сервис может быть развернут нативно.
## Подготовка к развертыванию
Для развертывания необходим Docker.

Для сбора образа необходимо исполнить следующую команду:
```sh
docker build -t push-service:1.0 .
```

## Развертывание с помощью Docker и готовой инфраструктуры
Для развертывания сервиса с использованием готовой инфраструктуры необходимо настроить переменные окружения необходимым образом, а затем запустить его с помощью следующей команды:
```sh
docker run -p 8080:8080 -p 9000:9000 push-service:1.0
```
Проброс портов должен быть изменен в случае других переменных окружения.
После этого необходимо из контейнера выполнить следующую команду с корректными переменными окружения:
```sh
./push migrate
```
## Развертывание с помощью Docker Compose
Для развертывания сервиса с помощью Docker Compose можно воспользоваться готовым файлом с конфигурацией и использовать следующую команду:
```sh
docker compose up
```
После этого будет произведено развертывание всех зависимостей, применены миграции, развертывание самого сервиса.